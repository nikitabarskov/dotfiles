# GitHub organisation specific configurations
[includeIf "hasconfig:remote.*.url:git@github.com:nikitabarskov/*.git"]
	path = ~/.config/git/nikitabarskov.gitconfig
[includeIf "hasconfig:remote.*.url:git@github.com:hirn-studio/*.git"]
	path = ~/.config/git/hirn.studio.gitconfig
[includeIf "hasconfig:remote.*.url:git@github.com:deepinsight-io/*.git"]
	path = ~/.config/git/deepinsight.gitconfig

[user]
	name = Nikita Barskov

[url "ssh://git@github.com"]
	insteadOf = https://github.com

[core]
	editor = zed --wait
	autocrlf = input

[init]
	defaultBranch = main

[commit]
	gpgsign = true
	signoff = true
[format]
    signOff = true
[tag]
	gpgsign = true
	signoff = true
[push]
	autoSetupRemote = true
[pull]
	rebase = true


[gpg]
	format = ssh
[gpg "ssh"]
	program = "/opt/1Password/op-ssh-sign"
[alias]
	bt = "!bt() { git checkout -b nikita.barskov-$(date +\"%Y%m%dT%H%M%S\")-$1; }; bt"
	gone = "!git fetch -p && git for-each-ref --format '%(refname:short) %(upstream:track)' | awk '$2 == \"[gone]\" {print $1}' | xargs -r git branch -D"
	amend = commit -s - --amend
	rb = "!f() { \
		set -e; \
		curr=\"$(git branch --show-current)\"; \
		if [ -z \"$curr\" ]; then \
			echo \"Not on a branch (detached HEAD?).\" >&2; \
			exit 1; \
		fi; \
		base=\"$(gh pr list --head \"$curr\" --json baseRefName --jq '.[0].baseRefName' 2>/dev/null || true)\"; \
		if [ -z \"$base\" ]; then \
			echo \"No open PR found for branch '$curr'.\" >&2; \
			exit 1; \
		fi; \
		echo \"Rebasing '$curr' onto 'origin/$base'...\"; \
		git fetch origin \"$base\"; \
		git rebase \"origin/$base\"; \
	}; f"
    dl = -c diff.external=difft log -p --ext-diff
   	ds = -c diff.external=difft show --ext-diff
    dft = -c diff.external=difft diff

[difftool "difftastic"]
    cmd = difft "$MERGED" "$LOCAL" "abcdef1" "100644" "$REMOTE" "abcdef2" "100644"

[difftool]
    prompt = false

[pager]
   difftool = true

[diff]
   tool = difftastic
   external = difft

