- name: Install Git (macOS)
  homebrew:
    name: git
    state: present
  when: ansible_os_family == "Darwin"

- name: Install gpg to sign commits (macOS)
  homebrew:
    name:
      - gpg2
      - gnupg
      - pinetry-mac
    state: present
  when: ansible_os_family == "Darwin"

- name: Create .gnupg directory (macOS)
  file:
    path: "$HOME/.gnupg"
    state: directory
    mode: u=rwx,g=rwx,o=rwx
  when: ansible_os_family == "Darwin"

- name: Creating a file with content (macOS)
  copy:
    dest: "$HOME/.gnupg/gpg.conf"
    content: |
        use-agent
  when: ansible_os_family == "Darwin"


- name: Change permission on .gnupg directory (macOS)
  file:
    path: "$HOME/.gnupg"
    state: directory
    mode: u=rw,g=,o=
  when: ansible_os_family == "Darwin"


- name: Run "apt update"
  become: true
  apt:
    update_cache: true
  when: ansible_os_family == "elementary OS"

- name: Install Git (elementary OS)
  become: true
  apt:
    name: git
    state: latest
  when: ansible_os_family == "elementary OS"

- name: Install gpg to sign commits (elementary OS)
  become: true
  apt:
    name: gnupg
    state: latest
  when: ansible_os_family == "elementary OS"


- name: Configure global .gitconfig
  template:
    src: "global.gitconfig.j2"
    dest: "$HOME/.gitconfig"
    force: true
    mode: u=rw,g=,o=

- name: Create .config/git directories
  file:
    path: "$HOME/.config/git"
    state: directory
    mode: u=rwx,g=rx,o=rx

- name: Configure local `.gitconfig`s
  template:
    src: ".gitconfig.j2"
    dest: "$HOME/.config/git/{{ item.config }}.gitconfig"
    force: true
    mode: u=rw,g=,o=
  with_items: "{{ local_gitconfigs }}"
